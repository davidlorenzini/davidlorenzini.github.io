(()=>{"use strict";let e,t;const n=new WeakMap,o=new WeakMap,r=new WeakMap,a=new WeakMap,s=new WeakMap;let c={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return o.get(e);if("objectStoreNames"===t)return e.objectStoreNames||r.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return d(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function i(a){return"function"==typeof a?(s=a)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(t||(t=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(s)?function(...e){return s.apply(l(this),e),d(n.get(this))}:function(...e){return d(s.apply(l(this),e))}:function(e,...t){const n=s.call(l(this),e,...t);return r.set(n,e.sort?e.sort():[e]),d(n)}:(a instanceof IDBTransaction&&function(e){if(o.has(e))return;const t=new Promise(((t,n)=>{const o=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",a),e.removeEventListener("abort",a)},r=()=>{t(),o()},a=()=>{n(e.error||new DOMException("AbortError","AbortError")),o()};e.addEventListener("complete",r),e.addEventListener("error",a),e.addEventListener("abort",a)}));o.set(e,t)}(a),i=a,(e||(e=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((e=>i instanceof e))?new Proxy(a,c):a);var s,i}function d(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const o=()=>{e.removeEventListener("success",r),e.removeEventListener("error",a)},r=()=>{t(d(e.result)),o()},a=()=>{n(e.error),o()};e.addEventListener("success",r),e.addEventListener("error",a)}));return t.then((t=>{t instanceof IDBCursor&&n.set(t,e)})).catch((()=>{})),s.set(t,e),t}(e);if(a.has(e))return a.get(e);const t=i(e);return t!==e&&(a.set(e,t),s.set(t,e)),t}const l=e=>s.get(e),u=["get","getKey","getAll","getAllKeys","count"],f=["put","add","delete","clear"],h=new Map;function m(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(h.get(t))return h.get(t);const n=t.replace(/FromIndex$/,""),o=t!==n,r=f.includes(n);if(!(n in(o?IDBIndex:IDBObjectStore).prototype)||!r&&!u.includes(n))return;const a=async function(e,...t){const a=this.transaction(e,r?"readwrite":"readonly");let s=a.store;return o&&(s=s.index(t.shift())),(await Promise.all([s[n](...t),r&&a.done]))[0]};return h.set(t,a),a}var p;p=c,c={...p,get:(e,t,n)=>m(e,t)||p.get(e,t,n),has:(e,t)=>!!m(e,t)||p.has(e,t)};const g=function(e,t,{blocked:n,upgrade:o,blocking:r,terminated:a}={}){const s=indexedDB.open(e,t),c=d(s);return o&&s.addEventListener("upgradeneeded",(e=>{o(d(s.result),e.oldVersion,e.newVersion,d(s.transaction))})),n&&s.addEventListener("blocked",(()=>n())),c.then((e=>{a&&e.addEventListener("close",(()=>a())),r&&e.addEventListener("versionchange",(()=>r()))})).catch((()=>{})),c}("list",1,{upgrade(e,t,n,o){e.objectStoreNames.contains("list")||(e.createObjectStore("test",{keyPath:"id",autoIncrement:!0}),console.log("Store created"))}});!async function(){let e=await(t="test",g.then((async function(e){let n=e.transaction(t,"readonly").objectStore(t),o=await n.getAll();return console.log("Retrieved all items from store"),o})).catch((e=>console.log("Error while retrieving data: ",e))));var t;if(console.log("Get all: ",e),e){let t=document.createElement("ul");document.body.appendChild(t),e.map((e=>{let n=document.createElement("li");n.innerHTML=JSON.stringify(e),t.appendChild(n)}))}}(),document.querySelector("button").addEventListener("click",(async function(e){await e.preventDefault(),console.log("Button clicked");let t=String.fromCharCode(Math.floor(25*Math.random()+97),Math.floor(25*Math.random()+97),Math.floor(25*Math.random()+97),Math.floor(25*Math.random()+97),Math.floor(25*Math.random()+97),Math.floor(25*Math.random()+97),Math.floor(25*Math.random()+97),Math.floor(25*Math.random()+97)),n=Math.floor(1e4*Math.random());await function(e,t,n){g.then((o=>{let r=o.transaction(e,"readwrite");return r.objectStore(e).add({key:t,value:n,time:Date.now()}),r.complete})).then((e=>{e?console.log("Item added to store"):console.log("Item couldnt be addded to store")})).catch((e=>console.log("Error while adding data: ",e)))}("test",t,n)}))})();